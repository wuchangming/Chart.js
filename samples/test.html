<!doctype html>
<html>

<head>
    <title>Chart with xAxis Filtering</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="../Chart.js"></script>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <style>

    </style>
</head>

<body style="width:100%;display:absolute;margin:0px;">
    <div style="width:100%;">
        <canvas id="canvas" height="300px"></canvas>
    </div>
    <br>
    <br>
    <button id="randomizeData">Randomize Data</button>
    <button id="addDataset">Add Dataset</button>
    <button id="removeDataset">Remove Dataset</button>
    <button id="addData">Add Data</button>
    <button id="removeData">Remove Data</button>
    <script>
        var randomScalingFactor = function() {
            return Math.round(Math.random() * 50 * (Math.random() > 0.5 ? 1 : 1)) + 50;
        };
        var randomColorFactor = function() {
            return Math.round(Math.random() * 255);
        };
        var randomColor = function(opacity) {
            return 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',' + (opacity || '.3') + ')';
        };

        var config = {
            type: 'line',
            data: {
                labels: ["01/21",
                "01/22",
                "01/25",
                "01/26",
                "01/27",
                "01/28",
                "01/29",
                "02/01",
                "02/02",
                "02/03",
                "02/04",
                "02/05",
                "02/15",
                "02/16",
                "02/17",
                "02/18",
                "02/19",
                "02/22",
                "02/23",
                "02/24",
                "02/25",
                "02/26",
                "02/29",
                "03/01",
                "03/02",
                "03/03",
                "03/04",
                "03/07",
                "03/08",
                "03/09"],
                datasets: [{
                    label: "My Second dataset",
                    data: [1.3580,
                1.3610,
                1.3640,
                1.3600,
                1.3590,
                1.3590,
                1.3640,
                1.3660,
                1.3670,
                1.3660,
                1.3670,
                1.3670,
                1.3680,
                1.3680,
                1.3680,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3690,
                1.3700,
                1.3710]
                }]
            },
            options: {
                elements :{
                        line:{
                            fill: false,
                            borderWidth: 2,
                            borderColor: 'rgb(234,85,12)'
                        }
                },
                responsive: false,
                scales: {
                    xAxes: [{
                        display: true,
                        ticks: {
                            // userCallback: function(dataLabel, index) {
                            //     return index % 2 === 0 ? dataLabel : '';
                            // },
                            maxRotation: 0,
                			minRotation: 0,
                            fontSize: 13
                        }
                    }],
                    yAxes: [{
                        display: true,
                        beginAtZero: false,
                        ticks: {
                            padding: 5,
                            maxTicksLimit: 5,
                            fontSize: 13,
                            userCallback: function(dataLabel) {
                                // debugger;
                                return parseFloat(dataLabel).toFixed(4);
                            }
                        }
                    }]
                }
            }
        };
        var length = config.data.labels.length;
        // var length = Math.floor(Math.random() * config.data.labels.length);
        console.log('length', length);
        // length = 12
        config.data.labels = config.data.labels.slice(0, length);
        config.data.datasets[0].data = config.data.datasets[0].data.slice(0, length);

        $.each(config.data.datasets, function(i, dataset) {
            // dataset.borderColor = randomColor(0.4);
            dataset.backgroundColor = randomColor(0.5);
            dataset.pointBorderColor = randomColor(0.7);
            dataset.pointBackgroundColor = randomColor(0.5);
            dataset.pointBorderWidth = 1;
        });

        console.log(config.data);

        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myLine = new Chart(ctx, config);
        };

        $('#randomizeData').click(function() {
            $.each(config.data.datasets, function(i, dataset) {
                dataset.data = dataset.data.map(function() {
                    return randomScalingFactor();
                });

            });

            window.myLine.update();
        });

        $('#addDataset').click(function() {
            var newDataset = {
                label: 'Dataset ' + config.data.datasets.length,
                borderColor: randomColor(0.4),
                backgroundColor: randomColor(0.5),
                pointBorderColor: randomColor(0.7),
                pointBackgroundColor: randomColor(0.5),
                pointBorderWidth: 1,
                data: [],
            };

            for (var index = 0; index < config.data.labels.length; ++index) {
                newDataset.data.push(randomScalingFactor());
            }

            config.data.datasets.push(newDataset);
            window.myLine.update();
        });

        $('#addData').click(function() {
            if (config.data.datasets.length > 0) {
                config.data.labels.push('dataset #' + config.data.labels.length);

                for (var index = 0; index < config.data.datasets.length; ++index) {
                    config.data.datasets[index].data.push(randomScalingFactor());
                }

                window.myLine.update();
            }
        });

        $('#removeDataset').click(function() {
            config.data.datasets.splice(0, 1);
            window.myLine.update();
        });

        $('#removeData').click(function() {
            config.data.labels.splice(-1, 1); // remove the label first

            config.data.datasets.forEach(function(dataset, datasetIndex) {
                dataset.data.pop();
            });

            window.myLine.update();
        });
    </script>
</body>

</html>
